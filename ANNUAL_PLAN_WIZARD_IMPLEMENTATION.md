# ๐ ูุนุงูุฌ ุฎุทุฉ ุงูุชุฏููู ุงูุณูููุฉ (RBIA) - ุฏููู ุงูุชูููุฐ

**ุงูุชุงุฑูุฎ:** 21 ุฃูุชูุจุฑ 2025  
**ุงูุญุงูุฉ:** ๐ ููุฏ ุงูุชูููุฐ (ุงููุฑุญูุฉ 1 ูู 3)  
**Git Commit:** `8991dd2`

---

## โ ูุง ุชู ุฅูุฌุงุฒู (ุงููุฑุญูุฉ 1)

### 1. Schema ูุงุนุฏุฉ ุงูุจูุงูุงุช โ
**ุงูููู:** `prisma/migrations/create_annual_plans.sql`

#### ุงูุฌุฏุงูู:
- โ `core.annual_plans` - ุงูุฎุทุท ุงูุณูููุฉ
- โ `core.plan_tasks` - ุงูููุงู ุถูู ูู ุฎุทุฉ
- โ Indexes ูุชุญุณูู ุงูุฃุฏุงุก
- โ Triggers ููุชุญุฏูุซุงุช ุงูุชููุงุฆูุฉ
- โ RLS Policies ููุฃูุงู
- โ View: `vw_plan_overview` ููุชูุงุฑูุฑ

### 2. Validation Schemas โ
**ุงูููู:** `lib/schemas/annual-plan.schema.ts`

#### ุงููุฒุงูุง:
- โ Zod schemas ููุชุญูู ูู ุงูุจูุงูุงุช
- โ ุฑุณุงุฆู ุฎุทุฃ ุจุงูุนุฑุจูุฉ ูุงุถุญุฉ
- โ TypeScript types ูุณุชุฎุฑุฌุฉ ุชููุงุฆูุงู
- โ Label maps ูุนุฑุถ ุงูููุงุฆู
- โ Helper functions

### 3. ุงููููู ุงูุฑุฆูุณู โ
**ุงูููู:** `features/annual-plan/AnnualPlanWizard.tsx`

#### ุงููุฒุงูุง:
- โ ูุนุงูุฌ ุจูุฑุญูุชูู ูุน progress bar
- โ ุญูุธ ููุณูุฏุฉ ุชููุงุฆู
- โ ุชุญุฐูุฑ ุนูุฏ ุงูุฅุบูุงู ุจุฏูู ุญูุธ
- โ RTL support ูุงูู
- โ Responsive (960-1040px)

---

## ๐ ุงููุชุทูุจุงุช ุงูุจุงููุฉ (ุงููุฑุญูุฉ 2)

### 1. ูููุฐุฌ ุงููุฑุญูุฉ ุงูุฃููู
**ุงูููู ุงููุทููุจ:** `features/annual-plan/AnnualPlanStep1Form.tsx`

#### ุงูุญููู ุงููุทููุจุฉ:

```tsx
interface Step1FormProps {
  initialData?: AnnualPlanStep1;
  onComplete: (data: AnnualPlanStep1) => void;
  onSaveDraft: () => void;
  isLoading: boolean;
}

// ุงูุญููู ุงูุฅูุฒุงููุฉ:
1. plan_ref (ูุต) - ุงูุฑูู ุงููุฑุฌุนู
   - ุชุญูู: 4-20 ุญุฑูุ A-Za-z0-9-
   - ูุซุงู: ADP-2025
   
2. fiscal_year (ุฑูู) - ุงูุณูุฉ ุงููุงููุฉ
   - ุชุญูู: 2000-2100
   - ูุซุงู: 2025
   
3. prepared_date (ุชุงุฑูุฎ) - ุชุงุฑูุฎ ุงูุฅุนุฏุงุฏ
   - ุชุญูู: <= ุงููููุ ุถูู ุงูุณูุฉ ุงููุงููุฉ
   - ุตูุบุฉ: YYYY-MM-DD
   
4. approved_by (ูุงุฆูุฉ) - ุงูุฌูุฉ ุงููุนุชูุฏุฉ
   - ุฎูุงุฑุงุช: ูุฌูุณ ุงูุฅุฏุงุฑุฉุ ุงููุฌูุฉ ุงูุนููุงุ ุฅุฏุงุฑุฉ ุงูุชุฏููู...

// ุงูุญููู ุงูุงุฎุชูุงุฑูุฉ:
5. prepared_by - ุงุณู ุงููุนุฏ (auto-fill ูู ุงููุณุชุฎุฏู)
6. standards - ูุนุงููุฑ ุงูุฅุนุฏุงุฏ (textarea)
7. methodology - ุงููููุฌูุฉ (textarea)
8. objectives - ุงูุฃูุฏุงู (textarea)
9. risk_sources - ูุตุงุฏุฑ ุชูููู ุงููุฎุงุทุฑ (checkboxes ูุชุนุฏุฏุฉ)
```

#### ุงููุชุทูุจุงุช ุงููุธูููุฉ:
- โ React Hook Form + Zod validation
- โ ุฑุณุงุฆู ุฎุทุฃ ุนุฑุจูุฉ ุชุญุช ูู ุญูู
- โ ุชุญูู ููุฑู (real-time validation)
- โ ุฒุฑ "ุงูุชุงูู" ูุนุทู ุญุชู ุงุณุชููุงุก ุงูุญููู ุงูุฅูุฒุงููุฉ
- โ ุฒุฑ "ุญูุธ ููุณูุฏุฉ" ูุชุงุญ ุฏุงุฆูุงู
- โ ุชูุณูู RTL ูุน labels ุนูู ุงููููู
- โ Responsive ููููุจุงูู

### 2. ูููุฐุฌ ุงููุฑุญูุฉ ุงูุซุงููุฉ
**ุงูููู ุงููุทููุจ:** `features/annual-plan/AnnualPlanStep2Form.tsx`

#### ุงูููุฒุงุช ุงููุทููุจุฉ:

```tsx
interface Step2FormProps {
  planId: number;
  initialTasks: PlanTask[];
  onComplete: (tasks: PlanTask[]) => void;
  onBack: () => void;
  onSaveDraft: () => void;
  onTasksChange: (tasks: PlanTask[]) => void;
  isLoading: boolean;
}

// ุฌุฏูู/ูุงุฆูุฉ ุงูููุงู:
- ุนุฑุถ ุฌุฏูู ุจุฌููุน ุงูููุงู ุงููุถุงูุฉ
- ุฃุนูุฏุฉ: ุงูุฑูู ุงูุชุณูุณููุ ุงูุนููุงูุ ุงูุฅุฏุงุฑุฉุ ููุน ุงููููุฉุ 
         ุงูุฎุทูุฑุฉุ ุงูุฃููููุฉุ ุงูุฑุจุนุ ุงููุฏุฉุ ุฅุฌุฑุงุกุงุช

// ุฃุฒุฑุงุฑ:
1. "ุฅุถุงูุฉ ูููุฉ" - ููุชุญ ูููุฐุฌ ุฅุถุงูุฉ
2. "ุชุนุฏูู" - ููู ูููุฉ
3. "ุญุฐู" - ููู ูููุฉ
4. "ูุณุฎ" - ููุณุฎ ุจูุงูุงุช ุงููููุฉ ูุฅูุดุงุก ุฌุฏูุฏุฉ
```

#### ูููุฐุฌ ุงููููุฉ (Task Form):

```tsx
// ุงูุญููู (ุฌููุนูุง ุฅูุฒุงููุฉ ูุงุนุฏุง task_ref, assignee, notes):
1. seq_no - ุงูุฑูู ุงูุชุณูุณูู (auto-increment)
2. task_ref - ุงูุฑูู ุงููุฑุฌุนู ูููููุฉ (ุงุฎุชูุงุฑู)
3. dept_id - ุงูุฅุฏุงุฑุฉ/ุงููุณู (select from core.depts)
4. title - ุงุณู ุงููููุฉ (ูุต)
5. task_type - ููุน ุงููููุฉ (select)
6. risk_level - ุฏุฑุฌุฉ ุงูุฎุทูุฑุฉ (select)
7. impact_level - ุชูููู ุงูุฃุซุฑ (select)
8. priority - ุงูุฃููููุฉ (select)
9. scheduled_quarter - ุชูููุช ุงูุชูููุฐ (Q1/Q2/Q3/Q4)
10. duration_days - ุงููุฏุฉ ุงูุชูุฏูุฑูุฉ (ุฑูู โฅ1)
11. assignee - ุงููุฏูู ุงููุณุคูู (ุงุฎุชูุงุฑู)
12. notes - ุชุนูููุงุช (textarea ุงุฎุชูุงุฑู)
```

#### ุงููุชุทูุจุงุช ุงููุธูููุฉ:
- โ ุฅุฏุงุฑุฉ ูุงููุฉ ููููุงู (CRUD)
- โ Validation ููู ุญูู
- โ Auto-save ุนูุฏ ูู ุชุบููุฑ
- โ ุญุงูุฉ ูุงุฑุบุฉ: "ุฃุถู ุฃูู ูููุฉ" ูุน ุฒุฑ ูุจูุฑ
- โ ุชุญุฐูุฑ: "ููุฒู ูููุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู" ุนูุฏ ูุญุงููุฉ ุงูุฅููุงุก
- โ ุฒุฑ "ุงูุณุงุจู" ููุนูุฏุฉ ูููุฑุญูุฉ 1
- โ ุฒุฑ "ุฅููุงุก ูุญูุธ" (ูุนุทู ุฅุฐุง ูุง ุชูุฌุฏ ููุงู)

### 3. API Routes
**ุงููููุงุช ุงููุทููุจุฉ:**

#### `app/api/annual-plans/route.ts`
```tsx
// POST - Create new plan
// GET - List all plans (with filters)
```

#### `app/api/annual-plans/[id]/route.ts`
```tsx
// GET - Get plan by ID with tasks
// PUT - Update plan
// DELETE - Delete plan (draft only)
// PATCH - Update plan status
```

#### `app/api/annual-plans/[id]/tasks/route.ts`
```tsx
// POST - Add task to plan
// GET - List tasks for plan
```

#### `app/api/annual-plans/[id]/tasks/[taskId]/route.ts`
```tsx
// PUT - Update task
// DELETE - Delete task
```

### 4. ุชูุงูู ูุน ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
**ุชุนุฏูู:** `app/(app)/rbia/plan/RbiaPlanView.tsx`

```tsx
// ุฅุถุงูุฉ:
const [showWizard, setShowWizard] = useState(false);

// ุงุณุชุจุฏุงู ุฒุฑ "ุฅูุดุงุก ุฎุทุฉ ุฌุฏูุฏุฉ":
<Button onClick={() => setShowWizard(true)}>
  <Plus /> ุฅูุดุงุก ุฎุทุฉ ุฌุฏูุฏุฉ
</Button>

// ุฅุถุงูุฉ ุงููุนุงูุฌ:
<AnnualPlanWizard
  open={showWizard}
  onClose={() => setShowWizard(false)}
  onSuccess={(planId) => {
    // Refresh plans list
    loadPlanData();
    // Navigate to plan summary
    toast.success('ุชู ุฅูุดุงุก ุงูุฎุทุฉ ุจูุฌุงุญ!');
  }}
/>
```

---

## ๐ฏ ูุนุงููุฑ ุงููุจูู (Acceptance Criteria)

### ูุธููู:
- โณ ุงููุนุงูุฌ ูุธูุฑ ุนูุฏ ุงูุถุบุท "ุฅูุดุงุก ุฎุทุฉ ุฌุฏูุฏุฉ"
- โณ ูุง ูููู ุงูุงูุชูุงู ูููุฑุญูุฉ 2 ูุจู ุงุณุชููุงู ุงูุญููู ุงูุฅูุฒุงููุฉ
- โณ "ุญูุธ ููุณูุฏุฉ" ูุนูู ูู ุฃู ููุช
- โณ ูููู ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ููุงู ูู ุงููุฑุญูุฉ 2
- โณ ูุง ูููู ุฅููุงุก ูุญูุธ ุจุฏูู ูููุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู
- โณ ุนูุฏ ุงููุฌุงุญ: ุงูุชูุงู ูููุฎุต ุงูุฎุทุฉ + ุดุงุฑุฉ "ุชู ุงูุญูุธ"

### ุชููู:
- โ ุณุฌูุงุช `annual_plans` ู `plan_tasks` ุชููุดุฃ ุจุดูู ุตุญูุญ
- โ ุงูุนูุงูุงุช ูุงูููุงุฑุณ ููุฌูุฏุฉ
- โ RLS policies ุชุนูู ุจุดูู ุตุญูุญ
- โณ ูู ุญุฏุซ ููุณุฌู ูู `audit_logs`
- โณ API endpoints ุชุนูู ูุน proper error handling

### UI/UX:
- โณ RTL support ูุงูู
- โณ Responsive: 1440/1280/1024/768/480px
- โณ ุฑุณุงุฆู ุฎุทุฃ ุนุฑุจูุฉ ูุงุถุญุฉ
- โณ ุชุญูู ููุฑู (real-time)
- โณ ุญุงูุฉ ูุงุฑุบุฉ ูููููุฉ
- โณ ุชุญุฐูุฑุงุช ุนูุฏ ูุญุงููุฉ ุงูุฅุบูุงู ุจุฏูู ุญูุธ

---

## ๐ฆ ุงููููุงุช ุงููุทููุจุฉ (To-Do)

### ููููุงุช React:
1. โ `AnnualPlanWizard.tsx` - ุงููุนุงูุฌ ุงูุฑุฆูุณู
2. โณ `AnnualPlanStep1Form.tsx` - ูููุฐุฌ ุงููุฑุญูุฉ 1
3. โณ `AnnualPlanStep2Form.tsx` - ูููุฐุฌ ุงููุฑุญูุฉ 2
4. โณ `TaskForm.tsx` - ูููุฐุฌ ุงููููุฉ ุงููุฑุนู
5. โณ `TasksList.tsx` - ูุงุฆูุฉ ุงูููุงู ูุน ุฅุฌุฑุงุกุงุช

### API Routes:
6. โณ `app/api/annual-plans/route.ts`
7. โณ `app/api/annual-plans/[id]/route.ts`
8. โณ `app/api/annual-plans/[id]/tasks/route.ts`
9. โณ `app/api/annual-plans/[id]/tasks/[taskId]/route.ts`

### Schema:
10. โ `lib/schemas/annual-plan.schema.ts`
11. โ `prisma/migrations/create_annual_plans.sql`

### ุชูุงูู:
12. โณ ุชุนุฏูู `RbiaPlanView.tsx` ูุฅุถุงูุฉ ุงููุนุงูุฌ
13. โณ ุฅูุดุงุก `audit_logs` entries

---

## ๐ง ุฎุทูุงุช ุงูุชูููุฐ ุงูุชุงููุฉ

### ุงููุฑุญูุฉ 2 (ุงูุชุงููุฉ):
1. ุฅูุดุงุก `AnnualPlanStep1Form.tsx` ูุน ุฌููุน ุงูุญููู
2. ุฅูุดุงุก `AnnualPlanStep2Form.tsx` ูุน ุฅุฏุงุฑุฉ ุงูููุงู
3. ุฅูุดุงุก `TaskForm.tsx` ูู modal/drawer ูููุตู
4. ุฅูุดุงุก API routes ุงูุฃุณุงุณูุฉ

### ุงููุฑุญูุฉ 3 (ุงูุฃุฎูุฑุฉ):
5. ุชูุงูู ูุน `RbiaPlanView.tsx`
6. Audit logging
7. ุงุฎุชุจุงุฑ ุดุงูู ููุชุฏูู ุงููุงูู
8. Responsive testing ุนูู ุฌููุน ุงูุฃุญุฌุงู

---

## ๐ก ููุงุญุธุงุช ุชูููุฉ

### Database:
- ุงุณุชุฎุฏุงู transactions ุนูุฏ ุฅูุดุงุก ุฎุทุฉ ูุน ููุงู
- Cascade delete: ุญุฐู ุงูุฎุทุฉ ูุญุฐู ููุงููุง ุชููุงุฆูุงู
- RLS: ููุท ููุดุฆ ุงูุฎุทุฉ ููููู ุงูุชุนุฏูู/ุงูุญุฐู

### Validation:
- Client-side: Zod schemas
- Server-side: ููุณ Zod schemas ููุฃูุงู
- Unique constraint ุนูู `plan_ref`

### UX:
- Auto-save ูู 30 ุซุงููุฉ ุฃู ุนูุฏ ุงูุชุบููุฑ
- Loading states ูุงุถุญุฉ
- Error boundaries ููุฃุฎุทุงุก ุบูุฑ ุงููุชููุนุฉ

---

## ๐ ุงูุชูุฏู ุงูุญุงูู

**ุงููุฑุญูุฉ 1:** โ 100% (Schema + Wizard Shell + Validation)  
**ุงููุฑุญูุฉ 2:** โณ 0% (Forms + API)  
**ุงููุฑุญูุฉ 3:** โณ 0% (Integration + Testing)

**ุงูุฅุฌูุงูู:** ๐ต 33% ููุชูู

---

**ุขุฎุฑ ุชุญุฏูุซ:** 21 ุฃูุชูุจุฑ 2025 - Commit `8991dd2`
