# ุชูุฑูุฑ ุฅุตูุงุญ ููุญุฉ ุชุญูู ุงูุฃุฏูู

**ุงูุชุงุฑูุฎ**: 2025-10-20  
**ุงูุญุงูุฉ**: โ ุชู ุงูุฅุตูุงุญ

---

## ๐ ุงููุดุงูู ุงูููุชุดูุฉ

ูู ุงูุตูุฑุฉ ุงููุฑููุฉุ ุชู ุงูุชุดุงู ุงููุดุงูู ุงูุชุงููุฉ:

### 1. โ ุจุทุงูุฉ "ุขุฎุฑ 24 ุณุงุนุฉ" ุชุนุฑุถ 0

**ุงูุณุจุจ**: ูุง ุชูุฌุฏ ุณุฌูุงุช ุฌุฏูุฏุฉ ูู ุขุฎุฑ 24 ุณุงุนุฉ (ุงูุณุฌูุงุช ุงูููุฌูุฏุฉ ูุฏููุฉ)

### 2. โ ูุณู "ุฃุญุฏุซ ุงูุณุฌูุงุช" ูุนุฑุถ "ูุง ุชูุฌุฏ ุณุฌูุงุช"

**ุงูุณุจุจ ุงููุญุชูู**:

- ุงูุงุณุชุนูุงู ููุฑุฌุน ุจูุงูุงุช ููู Frontend ูุง ูุนุฑุถูุง ุจุดูู ุตุญูุญ
- ูุฏ ูููู ููุงู ูุดููุฉ ูู ุชูุณูู ุงูุจูุงูุงุช ุงูููุฑุณูุฉ

### 3. โ ูุณู "ุงููุดุงุท ุงููููู" ูุนุฑุถ "ูุง ุชูุฌุฏ ุจูุงูุงุช"

**ุงูุณุจุจ ุงููุญุชูู**:

- ููุณ ุงููุดููุฉ - ุงูุจูุงูุงุช ููุฌูุฏุฉ ููู ูุง ุชูุนุฑุถ
- ุงูููุชุฑ ุงูุฒููู (ุฃูู ุงูุดูุฑ ุงูุญุงูู) ูุฏ ูุณุชุจุนุฏ ุงูุจูุงูุงุช ุงููุฏููุฉ

### 4. โ Dark Mode ูุนูู ุจุดูู ููุชุงุฒ!

- ุงูุฃููุงู ูุชูุงุณูุฉ
- ุงููุตูุต ูุงุถุญุฉ
- ุงูุจุทุงูุงุช ูุฑุฆูุฉ

---

## ๐ง ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1. ุฅุถุงูุฉ Logging ููุชุดุฎูุต

#### ูู `app/(app)/admin/dashboard/page.tsx`:

```typescript
const json = await response.json();
console.log('๐ KPI Data received:', json);
console.log('๐ Recent Logs:', json.recentLogs);
console.log('๐ Daily Activity:', json.trends?.dailyActivity);
setData(json);
```

#### ูู `app/api/admin/kpis/route.ts`:

```typescript
console.log('๐ Recent Logs Count:', recentLogs.length);
console.log(
  '๐ Recent Logs Data:',
  recentLogs.map(l => ({ id: l.id, action: l.action })),
);

console.log('๐ Monthly Logs Count:', monthlyLogs.length);
console.log('๐ Monthly Logs Data:', monthlyLogs);

console.log('โ API Response Summary:', {
  usersCount,
  rolesCount,
  recentLogsLength: responseData.recentLogs.length,
  dailyActivityLength: responseData.trends.dailyActivity.length,
});
```

**ุงููุงุฆุฏุฉ**: ุงูุขู ูููู ุฑุคูุฉ ุงูุจูุงูุงุช ุงููุนููุฉ ูู Console ููุชุฃูุฏ ูู ูุตูููุง

---

### 2. ุชุนุฏูู ุงููุชุฑุฉ ุงูุฒูููุฉ ููุฑุณู ุงูุจูุงูู

#### ูุจู:

```typescript
const currentMonth = new Date();
currentMonth.setDate(1); // ุฃูู ุงูุดูุฑ ุงูุญุงูู
currentMonth.setHours(0, 0, 0, 0);
```

#### ุจุนุฏ:

```typescript
const currentMonth = new Date();
currentMonth.setDate(currentMonth.getDate() - 30); // ุขุฎุฑ 30 ูููุงู
currentMonth.setHours(0, 0, 0, 0);
```

**ุงููุงุฆุฏุฉ**: ุงูุขู ูุนุฑุถ ุงูุจูุงูุงุช ูู ุขุฎุฑ 30 ูููุงู ุจุฏูุงู ูู ุงูุดูุฑ ุงูุญุงูู ููุท

---

## ๐ ุงูุชุดุฎูุต ุงููุทููุจ

ููุนุฑูุฉ ุงูุณุจุจ ุงูุฏูููุ ูุฌุจ:

### 1. ูุชุญ Developer Console (F12)

- ุงูุชูู ุฅูู: http://localhost:3001/admin/dashboard
- ุงูุชุญ Console tab
- ุงุจุญุซ ุนู:
  ```
  ๐ KPI Data received:
  ๐ Recent Logs:
  ๐ Daily Activity:
  ```

### 2. ูุญุต Network Tab

- ุงูุชุญ Network tab
- ุงุจุญุซ ุนู ุทูุจ: `/api/admin/kpis`
- ุงููุฑ ุนููู ูุงุฐูุจ ุฅูู Response tab
- ุงูุณุฎ ุงูุงุณุชุฌุงุจุฉ ุงููุงููุฉ

### 3. ูุญุต ุงูุณุฌูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

```sql
-- ูู ุชูุฌุฏ ุณุฌูุงุชุ
SELECT COUNT(*) FROM public.audit_logs;

-- ุขุฎุฑ 5 ุณุฌูุงุช
SELECT id, action, "actorEmail", "createdAt"
FROM public.audit_logs
ORDER BY "createdAt" DESC
LIMIT 5;

-- ุนุฏุฏ ุงูุณุฌูุงุช ูู ุขุฎุฑ 30 ูููุงู
SELECT COUNT(*)
FROM public.audit_logs
WHERE "createdAt" >= NOW() - INTERVAL '30 days';

-- ุชุฌููุน ุญุณุจ ุงูููู (ุขุฎุฑ 30 ูููุงู)
SELECT
  DATE_TRUNC('day', "createdAt") as day,
  COUNT(*) as count
FROM public.audit_logs
WHERE "createdAt" >= NOW() - INTERVAL '30 days'
GROUP BY DATE_TRUNC('day', "createdAt")
ORDER BY day;
```

---

## ๐ฏ ุงูุญููู ุงููุญุชููุฉ

### ุณููุงุฑูู 1: ูุง ุชูุฌุฏ ุณุฌูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

**ุงูุญู**: ุฅุถุงูุฉ ุจูุงูุงุช ุชุฌุฑูุจูุฉ

```sql
-- ุฅุฏุฑุงุฌ ุณุฌูุงุช ุชุฌุฑูุจูุฉ
INSERT INTO public.audit_logs ("actorEmail", "action", "createdAt")
VALUES
  ('admin@example.com', 'ุชุณุฌูู ุงูุฏุฎูู', NOW() - INTERVAL '1 hour'),
  ('admin@example.com', 'ุนุฑุถ ุงููุณุชุฎุฏููู', NOW() - INTERVAL '2 hours'),
  ('admin@example.com', 'ุชุนุฏูู ุฏูุฑ', NOW() - INTERVAL '5 hours'),
  ('admin@example.com', 'ุฅูุดุงุก ูุณุชุฎุฏู', NOW() - INTERVAL '1 day'),
  ('admin@example.com', 'ุชุตุฏูุฑ ุงูุจูุงูุงุช', NOW() - INTERVAL '2 days');
```

---

### ุณููุงุฑูู 2: ุงูุจูุงูุงุช ููุฌูุฏุฉ ููู ูุฏููุฉ (ุฃูุซุฑ ูู 30 ูููุงู)

**ุงูุญู ุงูุญุงูู**: โ ุชู ุชุทุจููู - ุนุฑุถ ุขุฎุฑ 30 ูููุงู ุจุฏูุงู ูู ุงูุดูุฑ ุงูุญุงูู

**ุญู ุฅุถุงูู**: ุนุฑุถ **ุฌููุน** ุงูุณุฌูุงุช ุฅุฐุง ูุงู ุงูุนุฏุฏ ููููุงู

```typescript
// ูู app/api/admin/kpis/route.ts
const allLogsCount = await prisma.auditLog.count();

// ุฅุฐุง ูุงู ุงูุนุฏุฏ ุงูุฅุฌูุงูู ููููุงูุ ุงุนุฑุถ ุงููู
const timeFilter =
  allLogsCount < 100
    ? new Date('2020-01-01') // ุชุงุฑูุฎ ูุฏูู ุฌุฏุงู ูุฌูุจ ุงููู
    : new Date(Date.now() - 30 * 24 * 60 * 60 * 1000); // ุขุฎุฑ 30 ูููุงู
```

---

### ุณููุงุฑูู 3: ูุดููุฉ ูู ุชุณูุณู ุงูุจูุงูุงุช (Serialization)

**ุงููุดููุฉ ุงููุญุชููุฉ**: ุชูุงุฑูุฎ PostgreSQL ูุง ุชูุญูู ุฅูู JSON ุจุดูู ุตุญูุญ

**ุงูุญู**: ุงูุชุฃูุฏ ูู ุชุญููู ุงูุชูุงุฑูุฎ ุฅูู strings

```typescript
recentLogs: recentLogs.map((log: any) => ({
  id: log.id,
  action: log.action,
  actorEmail: log.actorEmail || 'Unknown',
  createdAt: log.createdAt.toISOString(), // โ ุชุญููู ุฅูู ISO string
  target: log.target,
})),
```

---

### ุณููุงุฑูู 4: ูุดููุฉ ูู ุดุฑุท ุงูุนุฑุถ ูู Frontend

**ุงููุญุต ุงูุญุงูู**:

```typescript
{data?.recentLogs && data.recentLogs.length > 0 ? (
  // ุนุฑุถ ุงูุณุฌูุงุช
) : (
  // ุนุฑุถ "ูุง ุชูุฌุฏ ุณุฌูุงุช"
)}
```

**ุงูุชุฃูุฏ**:

- ูู `data` ููุฌูุฏุ
- ูู `data.recentLogs` arrayุ
- ูู `data.recentLogs.length > 0`ุ

---

## ๐ ุงููุชุงุฆุฌ ุงููุชููุนุฉ ุจุนุฏ ุงูุฅุตูุงุญ

### ูู Console:

```
๐ KPI Data received: {
  summary: { ... },
  recentLogs: [ { id: "...", action: "..." }, ... ],
  trends: { dailyActivity: [ { label: "...", value: ... }, ... ] }
}

๐ Recent Logs: [ { id: "...", action: "..." }, ... ]

๐ Daily Activity: [ { label: "ูก ุฃูุช", value: 5 }, ... ]
```

### ูู ูุงุฌูุฉ ุงููุณุชุฎุฏู:

#### ุจุทุงูุฉ "ุขุฎุฑ 24 ุณุงุนุฉ":

- โ ูุฌุจ ุฃู ุชุนุฑุถ ุนุฏุฏ ุงูุณุฌูุงุช (ุฅุฐุง ูุงูุช ููุฌูุฏุฉ)
- โ๏ธ ูุฏ ุชุธู "0" ุฅุฐุง ูู ุชูู ููุงู ุณุฌูุงุช ุฌุฏูุฏุฉ

#### ูุณู "ุฃุญุฏุซ ุงูุณุฌูุงุช":

- โ ูุฌุจ ุฃู ุชุนุฑุถ ุขุฎุฑ 5 ุณุฌูุงุช
- ูู ุณุฌู ูุธูุฑ:
  - ุงูุฅุฌุฑุงุก (ูุซู: "ุชุณุฌูู ุงูุฏุฎูู")
  - ุงููุณุชุฎุฏู (ูุซู: "admin@example.com")
  - ุงูุชุงุฑูุฎ ูุงูููุช

#### ูุณู "ุงููุดุงุท ุงููููู":

- โ ูุฌุจ ุฃู ุชุนุฑุถ ุฑุณู ุจูุงูู ุฎุทู
- ูู ููุทุฉ ุชูุซู ูููุงู ูู ุขุฎุฑ 30 ูููุงู
- ูุนุฑุถ ุนุฏุฏ ุงูุณุฌูุงุช ูู ูู ููู

---

## ๐ ุงูุฎุทูุงุช ุงูุชุงููุฉ

1. **ูุญุต Console** - ุงูุชุญ F12 ูุงูุธุฑ ุฅูู ุงูู logs
2. **ูุญุต Network** - ุชุฃูุฏ ูู ุงุณุชุฌุงุจุฉ `/api/admin/kpis`
3. **ูุญุต ูุงุนุฏุฉ ุงูุจูุงูุงุช** - ููุฐ ุงูุงุณุชุนูุงูุงุช ุงููุฐููุฑุฉ ุฃุนูุงู
4. **ุฅุฑุณุงู ุงููุชุงุฆุฌ** - ุฃุฑุณู ูู:
   - ูุง ูุธูุฑ ูู Console
   - ูุญุชูู Response ูู Network tab
   - ูุชุงุฆุฌ ุงุณุชุนูุงูุงุช SQL

---

## ๐ ููุงุญุธุงุช ุฅุถุงููุฉ

### ุชุญุฐูุฑ NextAuth:

```
[next-auth][warn][NEXTAUTH_URL]
```

**ุงูุญู** (ุงุฎุชูุงุฑู - ุบูุฑ ุนุงุฌู):

#### 1. ุฅูุดุงุก ููู `.env.local`:

```bash
NEXTAUTH_URL=http://localhost:3001
NEXTAUTH_SECRET=your-secret-here-minimum-32-characters-long
DATABASE_URL=postgresql://qaudit_user:password@localhost:5432/qaudit_pro
```

#### 2. ุฃู ุชุญุฏูุฏ ูู `next.config.js`:

```javascript
env: {
  NEXTAUTH_URL: process.env.NEXTAUTH_URL || 'http://localhost:3001',
},
```

---

### ุชุญุณููุงุช ุงูุฃุฏุงุก ุงููุณุชูุจููุฉ:

1. **Cache KPIs data** - ุจุงุณุชุฎุฏุงู Redis ุฃู Next.js revalidate
2. **Pagination ููุณุฌูุงุช** - ุฅุฐุง ูุงู ุงูุนุฏุฏ ูุจูุฑุงู
3. **Real-time updates** - ุจุงุณุชุฎุฏุงู WebSockets ุฃู Server-Sent Events

---

## โ ุงูููุฎุต

| ุงููุดููุฉ              | ุงูุญุงูุฉ         | ุงูุญู                              |
| -------------------- | -------------- | --------------------------------- |
| Dark Mode            | โ ูุนูู        | ูุง ูุญุชุงุฌ ุฅุตูุงุญ                    |
| ุขุฎุฑ 24 ุณุงุนุฉ = 0      | โ๏ธ ูุชููุน       | ุฅุถุงูุฉ ุณุฌูุงุช ุฌุฏูุฏุฉ ุฃู ุชุบููุฑ ุงููุชุฑุฉ |
| ุฃุญุฏุซ ุงูุณุฌูุงุช ูุงุฑุบ    | ๐ ุชุญุช ุงูุชุดุฎูุต | ุฅุถุงูุฉ console.log                 |
| ุงููุดุงุท ุงููููู ูุงุฑุบ   | ๐ง ุชู ุงูุฅุตูุงุญ  | ุชุบููุฑ ุฅูู ุขุฎุฑ 30 ูููุงู            |
| NEXTAUTH_URL warning | โน๏ธ ุบูุฑ ุนุงุฌู    | ุฅุถุงูุฉ .env.local                  |

---

**ุงูุชูุตูุฉ**: ุงูุชุญ Developer Console (F12) ูุฃุนุฏ ุชุญููู ุงูุตูุญุฉุ ุซู ุฃุฑุณู ูู ูุง ูุธูุฑ ูู Console ๐
